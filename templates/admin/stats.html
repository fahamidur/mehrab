{% extends "base.html" %}

{% block title %}System Statistics - Admin Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h2 class="text-3xl font-bold mb-8 text-gray-900 dark:text-white">System Statistics</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- User Statistics Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">User Statistics</h3>
            
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 dark:text-gray-400">Total Users:</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ user_count }}</span>
                </div>
                
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 dark:text-gray-400">Admin Users:</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ admin_count }}</span>
                </div>
                
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 dark:text-gray-400">Regular Users:</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ regular_user_count }}</span>
                </div>
            </div>
            
            <!-- User Distribution Chart -->
            <div class="mt-6">
                <canvas id="userDistributionChart" height="200"></canvas>
            </div>
        </div>
        
        <!-- Article Statistics Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Article Statistics</h3>
            
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 dark:text-gray-400">Total Articles:</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ article_count }}</span>
                </div>
                
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 dark:text-gray-400">Articles Today:</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ today_article_count }}</span>
                </div>
                
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 dark:text-gray-400">Articles This Week:</span>
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ week_article_count }}</span>
                </div>
            </div>
            
            <!-- Article Growth Chart -->
            <div class="mt-6">
                <canvas id="articleGrowthChart" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Category Distribution -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Article Categories</h3>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div>
                <canvas id="categoryChart" height="250"></canvas>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Category</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Count</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Percentage</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {% for category, count in category_distribution.items() %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ category }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ count }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">
                                {{ "%.1f"|format((count / article_count) * 100) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Source Distribution -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Article Sources</h3>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div>
                <canvas id="sourceChart" height="250"></canvas>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Source</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Count</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Percentage</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {% for source, count in source_distribution.items() %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ source }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ count }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">
                                {{ "%.1f"|format((count / article_count) * 100) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Daily Article Growth -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Articles Added in Last 7 Days</h3>
        <canvas id="dailyArticleChart" height="100"></canvas>
    </div>
    
    <!-- Back button -->
    <div class="mt-8">
        <a href="{{ url_for('admin_dashboard') }}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Dashboard
        </a>
    </div>
</div>

<script>
// Wait for the page to load
document.addEventListener('DOMContentLoaded', function() {
    // User Distribution Chart (Doughnut)
    const userCtx = document.getElementById('userDistributionChart').getContext('2d');
    new Chart(userCtx, {
        type: 'doughnut',
        data: {
            labels: ['Admin Users', 'Regular Users'],
            datasets: [{
                data: [{{ admin_count }}, {{ regular_user_count }}],
                backgroundColor: ['#3B82F6', '#10B981'],
                hoverBackgroundColor: ['#2563EB', '#059669']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    
    // Article Growth Chart (Line)
    const growthCtx = document.getElementById('articleGrowthChart').getContext('2d');
    new Chart(growthCtx, {
        type: 'line',
        data: {
            labels: ['Total Articles', 'Today', 'This Week'],
            datasets: [{
                label: 'Article Count',
                data: [{{ article_count }}, {{ today_article_count }}, {{ week_article_count }}],
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderColor: '#3B82F6',
                borderWidth: 2,
                pointBackgroundColor: '#3B82F6',
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
    
    // Category Distribution Chart (Pie)
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    new Chart(categoryCtx, {
        type: 'pie',
        data: {
            labels: [{% for category, count in category_distribution.items() %}'{{ category }}',{% endfor %}],
            datasets: [{
                data: [{% for category, count in category_distribution.items() %}{{ count }},{% endfor %}],
                backgroundColor: [
                    '#3B82F6', '#10B981', '#EF4444', '#F59E0B', '#8B5CF6', 
                    '#EC4899', '#06B6D4', '#84CC16', '#F97316', '#6366F1'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right'
                }
            }
        }
    });
    
    // Source Distribution Chart (Bar)
    const sourceCtx = document.getElementById('sourceChart').getContext('2d');
    new Chart(sourceCtx, {
        type: 'bar',
        data: {
            labels: [{% for source, count in source_distribution.items() %}'{{ source }}',{% endfor %}],
            datasets: [{
                label: 'Articles per Source',
                data: [{% for source, count in source_distribution.items() %}{{ count }},{% endfor %}],
                backgroundColor: '#3B82F6',
                borderColor: '#2563EB',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    
    // Daily Article Growth (Last 7 days)
    const dailyCtx = document.getElementById('dailyArticleChart').getContext('2d');
    // This would need data from the backend for the last 7 days
    // For now, we'll create a placeholder chart
    new Chart(dailyCtx, {
        type: 'line',
        data: {
            labels: ['Day 7', 'Day 6', 'Day 5', 'Day 4', 'Day 3', 'Day 2', 'Today'],
            datasets: [{
                label: 'Articles Added',
                data: [5, 8, 12, 6, 9, 15, {{ today_article_count }}],
                fill: false,
                borderColor: '#3B82F6',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});
</script>

<style>
/* Add some custom styling for the charts */
canvas {
    max-width: 100%;
}
</style>
{% endblock %}